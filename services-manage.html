<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Διαχείριση Υπηρεσιών - Rose Flower Shop</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Playfair+Display:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Playfair Display', 'serif'],
                    },
                    colors: {
                        rose: {
                            50: '#fff1f2',
                            100: '#ffe4e6',
                            200: '#fecdd3',
                            600: '#e11d48',
                            700: '#be123c',
                        }
                    }
                }
            }
        }
    </script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
        }
        
        /* Modal styles */
        .modal-overlay {
            animation: modalFadeIn 0.3s ease-out;
        }
        
        .modal-content {
            animation: modalSlideIn 0.3s ease-out;
        }
        
        /* Staggered animation delays */
        .stagger-1 { animation-delay: 0.05s; opacity: 0; }
        .stagger-2 { animation-delay: 0.10s; opacity: 0; }
        .stagger-3 { animation-delay: 0.15s; opacity: 0; }
        
        /* Line clamp */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans min-h-screen">

    <!-- Navbar -->
    <header class="bg-white shadow-sm sticky top-0 z-50" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-20">
                <div class="flex-shrink-0 flex items-center">
                    <a href="index.html" class="flex items-center space-x-2">
                        <span class="text-2xl font-serif font-bold text-rose-600">Rose</span>
                        <span class="text-xl font-light text-gray-600">Flower Shop</span>
                    </a>
                </div>
                
                <nav class="hidden md:flex space-x-8 items-center">
                    <a href="index.html" class="text-gray-700 hover:text-rose-600 transition font-medium">Αρχική</a>
                    <a href="about.html" class="text-gray-700 hover:text-rose-600 transition font-medium">Σχετικά</a>
                    <a href="services-public.html" class="text-gray-700 hover:text-rose-600 transition font-medium">Υπηρεσίες</a>
                    <a href="gallery-public.html" class="text-gray-700 hover:text-rose-600 transition font-medium">Συλλογή</a>
                    <a href="contact-public.html" class="text-gray-700 hover:text-rose-600 transition font-medium">Επικοινωνία</a>
                    
                    <button id="logout-btn" class="bg-rose-600 hover:bg-rose-700 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                        Αποσύνδεση
                    </button>
                </nav>

                <button id="mobile-menu-button" class="md:hidden text-gray-600 hover:text-rose-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>

        <div id="mobile-menu" class="hidden md:hidden bg-white border-t">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="index.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-rose-600 hover:bg-gray-50">Αρχική</a>
                <a href="about.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-rose-600 hover:bg-gray-50">Σχετικά</a>
                <a href="services-public.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-rose-600 hover:bg-gray-50">Υπηρεσίες</a>
                <a href="gallery-public.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-rose-600 hover:bg-gray-50">Συλλογή</a>
                <a href="contact-public.html" class="block px-3 py-2 rounded-md text-base font-medium text-gray-700 hover:text-rose-600 hover:bg-gray-50">Επικοινωνία</a>
                <button id="logout-btn-mobile" class="w-full text-left px-3 py-2 rounded-md text-base font-medium text-rose-600 hover:bg-gray-50">Αποσύνδεση</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Header -->
        <div class="mb-8 flex flex-col md:flex-row md:items-center md:justify-between">
            <div class="mb-4 md:mb-0">
                <a href="admin.html" class="inline-flex items-center text-gray-600 hover:text-rose-600 transition mb-4">
                    <i data-lucide="arrow-left" class="w-5 h-5 mr-2"></i>
                    Πίσω στη Διαχείριση
                </a>
                
                <h1 class="text-4xl font-serif font-bold text-gray-900 mb-2">Διαχείριση Υπηρεσιών</h1>
                <p class="text-gray-600">Επεξεργαστείτε τις υπηρεσίες που προσφέρετε</p>
            </div>
            
            <button id="new-service-btn" class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-3 rounded-lg font-medium transition flex items-center space-x-2 self-start md:self-auto">
                <i data-lucide="plus" class="w-5 h-5"></i>
                <span>Νέα Υπηρεσία</span>
            </button>
        </div>

        <!-- Services Grid -->
        <div id="services-container">
            <!-- Loading spinner -->
            <div id="loading-spinner" class="hidden flex justify-center items-center py-20">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-rose-600"></div>
            </div>

            <!-- Empty state -->
            <div id="empty-state" class="hidden bg-gray-50 rounded-2xl p-12 text-center">
                <i data-lucide="wrench" class="w-16 h-16 text-gray-400 mx-auto mb-4"></i>
                <p class="text-gray-600 mb-4">Δεν υπάρχουν υπηρεσίες</p>
                <button onclick="openCreateDialog()" class="bg-rose-600 hover:bg-rose-700 text-white px-6 py-3 rounded-lg font-medium transition">
                    Δημιουργήστε την πρώτη υπηρεσία
                </button>
            </div>

            <!-- Services grid -->
            <div id="services-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>

    </main>

    <!-- Modal Dialog -->
    <div id="modal-overlay" class="hidden fixed inset-0 bg-black/50 z-50 modal-overlay" onclick="closeModal(event)">
        <div class="flex items-center justify-center min-h-screen px-4 py-8">
            <div id="modal-content" class="modal-content bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation()">
                
                <!-- Modal Header -->
                <div class="px-6 py-4 border-b border-gray-200 flex items-center justify-between sticky top-0 bg-white z-10">
                    <h2 id="modal-title" class="text-2xl font-serif font-bold text-gray-900">Νέα Υπηρεσία</h2>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-gray-600 transition">
                        <i data-lucide="x" class="w-6 h-6"></i>
                    </button>
                </div>

                <!-- Modal Form -->
                <form id="service-form" class="px-6 py-6 space-y-6">
                    
                    <!-- Title -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Τίτλος *</label>
                        <input 
                            type="text" 
                            id="title" 
                            required 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent transition"
                            placeholder="π.χ. Γαμήλιοι Ανθοστολισμοί"
                        >
                    </div>

                    <!-- Category -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Κατηγορία *</label>
                        <select 
                            id="category" 
                            required 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent transition"
                        >
                            <option value="Weddings">Γάμοι</option>
                            <option value="Baptisms">Βαπτίσεις</option>
                            <option value="Events">Εκδηλώσεις</option>
                            <option value="Bouquets">Μπουκέτα</option>
                        </select>
                    </div>

                    <!-- Description -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Περιγραφή *</label>
                        <textarea 
                            id="description" 
                            required 
                            rows="4" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent transition resize-none"
                            placeholder="Περιγράψτε την υπηρεσία..."
                        ></textarea>
                    </div>

                    <!-- Pricing Info -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Πληροφορίες Τιμολόγησης</label>
                        <input 
                            type="text" 
                            id="pricing-info" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent transition"
                            placeholder="π.χ. Από €150 - €500"
                        >
                    </div>

                    <!-- Features -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Χαρακτηριστικά (ένα ανά γραμμή)</label>
                        <textarea 
                            id="features" 
                            rows="4" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent transition resize-none"
                            placeholder="Νυφική ανθοδέσμη&#10;Στολισμός εκκλησίας&#10;Διακόσμηση δεξίωσης"
                        ></textarea>
                    </div>

                    <!-- Example Image -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Εικόνα Παραδείγματος</label>
                        
                        <!-- Image Preview -->
                        <div id="image-preview" class="hidden mb-4">
                            <img id="preview-img" src="" alt="Preview" class="w-full h-48 object-cover rounded-lg">
                        </div>
                        
                        <!-- Upload Button -->
                        <label class="inline-flex items-center px-6 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-lg transition cursor-pointer">
                            <i data-lucide="upload" class="w-5 h-5 mr-2"></i>
                            <span id="image-upload-text">Ανέβασμα Εικόνας</span>
                            <input type="file" id="image-input" class="hidden" accept="image/*">
                        </label>
                    </div>

                    <!-- Order -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Σειρά Εμφάνισης</label>
                        <input 
                            type="number" 
                            id="order" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-rose-500 focus:border-transparent transition"
                            value="0"
                            min="0"
                        >
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">
                        <button 
                            type="button" 
                            onclick="closeModal()" 
                            class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 font-medium transition"
                        >
                            Ακύρωση
                        </button>
                        <button 
                            type="submit" 
                            class="px-6 py-3 bg-rose-600 hover:bg-rose-700 text-white rounded-lg font-medium transition"
                        >
                            <span id="submit-btn-text">Δημιουργία</span>
                        </button>
                    </div>

                </form>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- JavaScript -->
    <script>
        // ========================================
        // AUTHENTICATION CHECK
        // ========================================
        
        function checkAuth() {
            const isAuth = sessionStorage.getItem('admin_auth');
            if (isAuth !== 'true') {
                window.location.href = 'admin.html';
                return false;
            }
            return true;
        }

        if (!checkAuth()) {
            // Redirect handled
        }

        // ========================================
        // STATE MANAGEMENT
        // ========================================
        
        let editingService = null;

        // ========================================
        // UTILITY FUNCTIONS
        // ========================================
        
        function generateId() {
            return 'srv_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast px-6 py-4 rounded-lg shadow-lg text-white ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            toast.textContent = message;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ========================================
        // LOCAL STORAGE OPERATIONS
        // ========================================
        
        function getServices() {
            const data = localStorage.getItem('services');
            return data ? JSON.parse(data) : [];
        }

        function setServices(services) {
            localStorage.setItem('services', JSON.stringify(services));
        }

        function initializeMockData() {
            const existing = getServices();
            if (existing.length === 0) {
                const mockServices = [
                    {
                        id: generateId(),
                        created_date: new Date().toISOString(),
                        updated_date: new Date().toISOString(),
                        created_by: 'admin@example.com',
                        title: 'Νυφική Ανθοδέσμη & Στολισμός Εκκλησίας',
                        category: 'Weddings',
                        description: 'Δημιουργούμε μοναδικές νυφικές ανθοδέσμες και ολοκληρωμένο στολισμό εκκλησίας που αντανακλά το στυλ και την προσωπικότητά σας.',
                        pricing_info: 'Από €250 - €800',
                        features: ['Νυφική ανθοδέσμη premium', 'Στολισμός εκκλησίας', 'Boutonniere γαμπρού', 'Μπουκέτα παρανύμφων', 'Συμβουλές styling'],
                        example_image: 'https://images.unsplash.com/photo-1519741497674-611481863552?w=500',
                        order: 0
                    },
                    {
                        id: generateId(),
                        created_date: new Date().toISOString(),
                        updated_date: new Date().toISOString(),
                        created_by: 'admin@example.com',
                        title: 'Βάπτιση Αγοριού',
                        category: 'Baptisms',
                        description: 'Μοντέρνοι και κλασικοί στολισμοί για βάπτιση αγοριού. Επιλέγουμε λουλούδια και χρώματα που ταιριάζουν στο θέμα σας.',
                        pricing_info: 'Από €150 - €400',
                        features: ['Στολισμός εκκλησίας', 'Κεριά βάπτισης', 'Διακόσμηση δεξίωσης', 'Ανθικές πινελιές'],
                        example_image: 'https://images.unsplash.com/photo-1490750967868-88aa4486c946?w=500',
                        order: 0
                    }
                ];
                setServices(mockServices);
            }
        }

        // ========================================
        // RENDER FUNCTIONS
        // ========================================
        
        function renderServices() {
            const services = getServices();
            const grid = document.getElementById('services-grid');
            const emptyState = document.getElementById('empty-state');
            
            if (services.length === 0) {
                grid.innerHTML = '';
                emptyState.classList.remove('hidden');
            } else {
                emptyState.classList.add('hidden');
                
                grid.innerHTML = services.map((service, index) => `
                    <div class="bg-white border-2 border-gray-200 rounded-xl overflow-hidden hover:shadow-lg transition-shadow fade-in stagger-${(index % 3) + 1}">
                        ${service.example_image ? `
                            <img src="${service.example_image}" alt="${service.title}" class="w-full h-48 object-cover">
                        ` : ''}
                        
                        <div class="p-4">
                            <div class="mb-2">
                                <span class="text-xs text-rose-600 font-medium">${getCategoryLabel(service.category)}</span>
                            </div>
                            <h3 class="text-xl font-serif font-semibold text-gray-900 mb-2">${service.title}</h3>
                            <p class="text-gray-600 text-sm line-clamp-2 mb-4">${service.description}</p>
                            
                            <div class="flex gap-2">
                                <button 
                                    onclick='openEditDialog(${JSON.stringify(service).replace(/'/g, "&#39;")})' 
                                    class="flex-1 flex items-center justify-center space-x-2 px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 hover:bg-gray-50 transition"
                                >
                                    <i data-lucide="pencil" class="w-4 h-4"></i>
                                    <span>Επεξεργασία</span>
                                </button>
                                <button 
                                    onclick="deleteService('${service.id}')" 
                                    class="flex items-center justify-center px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg text-sm font-medium transition"
                                >
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
                
                // Re-initialize Lucide icons
                if (typeof lucide !== 'undefined') {
                    lucide.createIcons();
                }
            }
        }

        function getCategoryLabel(category) {
            const labels = {
                'Weddings': 'Γάμοι',
                'Baptisms': 'Βαπτίσεις',
                'Events': 'Εκδηλώσεις',
                'Bouquets': 'Μπουκέτα'
            };
            return labels[category] || category;
        }

        // ========================================
        // MODAL FUNCTIONS
        // ========================================
        
        function openCreateDialog() {
            editingService = null;
            document.getElementById('modal-title').textContent = 'Νέα Υπηρεσία';
            document.getElementById('submit-btn-text').textContent = 'Δημιουργία';
            
            // Reset form
            document.getElementById('service-form').reset();
            document.getElementById('image-preview').classList.add('hidden');
            
            // Show modal
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Re-initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        function openEditDialog(service) {
            editingService = service;
            document.getElementById('modal-title').textContent = 'Επεξεργασία Υπηρεσίας';
            document.getElementById('submit-btn-text').textContent = 'Ενημέρωση';
            
            // Fill form
            document.getElementById('title').value = service.title || '';
            document.getElementById('category').value = service.category || 'Weddings';
            document.getElementById('description').value = service.description || '';
            document.getElementById('pricing-info').value = service.pricing_info || '';
            document.getElementById('features').value = service.features ? service.features.join('\n') : '';
            document.getElementById('order').value = service.order || 0;
            
            // Show image preview if exists
            if (service.example_image) {
                document.getElementById('preview-img').src = service.example_image;
                document.getElementById('image-preview').classList.remove('hidden');
            } else {
                document.getElementById('image-preview').classList.add('hidden');
            }
            
            // Show modal
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            
            // Re-initialize icons
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        }

        function closeModal(event) {
            if (event && event.target !== event.currentTarget) return;
            
            document.getElementById('modal-overlay').classList.add('hidden');
            document.body.style.overflow = 'auto';
            editingService = null;
        }

        // Make functions globally accessible
        window.openCreateDialog = openCreateDialog;
        window.openEditDialog = openEditDialog;
        window.closeModal = closeModal;

        // ========================================
        // IMAGE UPLOAD
        // ========================================
        
        document.getElementById('image-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const uploadText = document.getElementById('image-upload-text');
            uploadText.textContent = 'Ανέβασμα...';
            
            const reader = new FileReader();
            
            reader.onload = function(event) {
                const dataUrl = event.target.result;
                document.getElementById('preview-img').src = dataUrl;
                document.getElementById('image-preview').classList.remove('hidden');
                uploadText.textContent = 'Ανέβασμα Εικόνας';
                showToast('Η εικόνα ανέβηκε επιτυχώς', 'success');
            };
            
            reader.onerror = function() {
                showToast('Κάτι πήγε στραβά', 'error');
                uploadText.textContent = 'Ανέβασμα Εικόνας';
            };
            
            reader.readAsDataURL(file);
        });

        // ========================================
        // FORM SUBMISSION
        // ========================================
        
        document.getElementById('service-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                title: document.getElementById('title').value,
                category: document.getElementById('category').value,
                description: document.getElementById('description').value,
                pricing_info: document.getElementById('pricing-info').value,
                features: document.getElementById('features').value.split('\n').filter(f => f.trim()),
                example_image: document.getElementById('preview-img').src || '',
                order: parseInt(document.getElementById('order').value) || 0
            };
            
            const services = getServices();
            
            if (editingService) {
                // Update existing service
                const index = services.findIndex(s => s.id === editingService.id);
                if (index !== -1) {
                    services[index] = {
                        ...services[index],
                        ...formData,
                        updated_date: new Date().toISOString()
                    };
                }
                showToast('Η υπηρεσία ενημερώθηκε επιτυχώς', 'success');
            } else {
                // Create new service
                const newService = {
                    id: generateId(),
                    created_date: new Date().toISOString(),
                    updated_date: new Date().toISOString(),
                    created_by: 'admin@example.com',
                    ...formData
                };
                services.push(newService);
                showToast('Η υπηρεσία δημιουργήθηκε επιτυχώς', 'success');
            }
            
            setServices(services);
            renderServices();
            closeModal();
        });

        // ========================================
        // DELETE SERVICE
        // ========================================
        
        function deleteService(serviceId) {
            if (!confirm('Είστε σίγουροι ότι θέλετε να διαγράψετε αυτή την υπηρεσία;')) {
                return;
            }
            
            const services = getServices();
            const updatedServices = services.filter(s => s.id !== serviceId);
            
            setServices(updatedServices);
            renderServices();
            showToast('Η υπηρεσία διαγράφηκε επιτυχώς', 'success');
        }

        window.deleteService = deleteService;

        // ========================================
        // EVENT LISTENERS
        // ========================================
        
        document.getElementById('new-service-btn').addEventListener('click', openCreateDialog);

        document.getElementById('mobile-menu-button').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        });

        function handleLogout() {
            sessionStorage.removeItem('admin_auth');
            sessionStorage.removeItem('admin_user');
            window.location.href = 'admin.html';
        }

        document.getElementById('logout-btn').addEventListener('click', handleLogout);
        document.getElementById('logout-btn-mobile').addEventListener('click', handleLogout);

        // ========================================
        // INITIALIZE
        // ========================================
        
        window.addEventListener('DOMContentLoaded', function() {
            initializeMockData();
            renderServices();
            
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }
        });
    </script>
</body>
</html>
